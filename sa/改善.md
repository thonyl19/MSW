# MSW 模擬架構優化建議：轉向「免編譯 (No-Build)」模式

## 1. 現狀分析 (Current Situation)
目前的 MSW 實作採用了**預編譯架構**：
- **依賴工具**：使用 `esbuild` 與 `esbuild-vue` 進行打包。
- **運作流程**：
    1. 修改 `src/handlers.js` 或 `MockPanel.vue`。
    2. 執行 `node build.js`。
    3. 產生成品 JS 檔案至目標目錄 (`wwwroot`)。
    4. 瀏覽器載入打包後的單一檔案。
- **缺點**：
    - 每次更動都需要手動或自動執行 Build。
    - 開發環境與執行環境之間存在「編譯」斷層，調試（Debug）時可能需要 Sourcemap。
    - 增加了專案的依賴複雜度（需安裝編譯器）。

## 2. 改善方案：原生 ES Modules (ESM) 架構
現代瀏覽器已廣泛支援原生 ES Modules，我們可以透過以下方式達成「免編譯」：

### A. 使用 Import Maps (依賴管理)
在目標 HTML 或共用 Layout 中加入 `importmap`，讓瀏覽器直接從 CDN 或本地路徑解析 `msw` 與 `vue`，無需下載到本地打包。
```html
<script type="importmap">
{
  "imports": {
    "vue": "https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.esm.browser.js",
    "msw/browser": "https://esm.sh/msw@2.12.10/browser"
  }
}
</script>
```

### B. 轉型組件：從 `.vue` 到 `.js`
由於 `.vue` 檔案必須經過編譯器處理，我們將 `MockPanel.vue` 改寫為純 JavaScript 組件：
- **樣式 (CSS)**：改用動態注入 `<style>` 標籤或使用 CSS-in-JS。
- **模板 (Template)**：使用樣板字串 (Template Literals) 或 `Vue.component` 的架構。

### C. 原生 ESM 載入
直接以 `<script type="module">` 載入 `src/mock-entry.js`，瀏覽器會根據 `import` 語句自動抓取關聯檔案。

## 3. 預期效益
1. **即改即複 (Hot Reload Feeling)**：修改任何 `handlers.js` 的 JS 檔案後，只需重新整理瀏覽器即可生效，完全不需要執行 `build.js`。
2. **開發一致性**：開發者看到的目錄結構與瀏覽器載入的檔案完全一致。
3. **零依賴運作**：只要有瀏覽器和靜態檔案伺服器，整個 Mock 系統就能運作，不再需要 `node_modules` 中的編譯工具。

## 4. 實作路徑 (規劃)
- [ ] **建立 Import Maps 範本**：定義核心依賴的存取路徑。
- [ ] **重構 MockPanel**：將 `.vue` 邏輯遷移至 `MockPanel.js`。
- [ ] **調整路徑邏輯**：修正 `mock-entry.js` 中的相對路徑，確保在瀏覽器環境下正確解析。
- [ ] **移除 Build 腳本**：確認新模式穩定後，可移除 `build.js` 及相關 devDependencies。

---
*備註：此計畫目前為規劃階段，尚未進行任何程式碼更動。*
